{
  "version": 3,
  "file": "body.js",
  "sourceRoot": "",
  "sources": [
    "body.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import \"./body.html\"\r\nimport \"./body.css\"\r\nimport \"./tablesort.js\"\r\nimport { Betoken } from \"../objects/betoken.js\"\r\nimport Chart from \"chart.js\"\r\nimport BigNumber from \"bignumber.js\"\r\n\r\nSEND_TX_ERR = \"There was an error during sending your transaction to the Ethereum blockchain. Please check that your inputs are valid and try again later.\"\r\nINPUT_ERR = \"There was an error in your input. Please fix it and try again.\"\r\nSTAKE_BOTH_SIDES_ERR = \"You have already staked on the opposite side of this proposal! If you want to change your mind, you can cancel your stake under \\\"My Proposals\\\".\"\r\n\r\n# Import web3\r\nWeb3 = require \"web3\"\r\nweb3 = window.web3\r\nhasWeb3 = false\r\nif web3?\r\n  web3 = new Web3(web3.currentProvider)\r\n  hasWeb3 = true\r\nelse\r\n  web3 = new Web3(new Web3.providers.HttpProvider(\"https://rinkeby.infura.io/m7Pdc77PjIwgmp7t0iKI\"))\r\n\r\n# Fund object\r\nbetoken_addr = new ReactiveVar(\"0xf8aebe816c944380b4e77d62c76ac31a8d710bc3\")\r\nbetoken = new Betoken(betoken_addr.get())\r\n\r\ntokenAddresses = new ReactiveVar(\r\n  AST: \"0xe7c7f37ad8b3c2114b1ebe2260a6958db4e83542\"\r\n  ETH: \"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee\"\r\n)\r\n# Session data\r\nuserAddress = new ReactiveVar(\"Not Available\")\r\nkairoBalance = new ReactiveVar(BigNumber(0))\r\nkairoTotalSupply = new ReactiveVar(BigNumber(0))\r\nsharesBalance = new ReactiveVar(BigNumber(0))\r\nsharesTotalSupply = new ReactiveVar(BigNumber(0))\r\n\r\ncyclePhase = new ReactiveVar(0)\r\nstartTimeOfCyclePhase = new ReactiveVar(0)\r\nphaseLengths = new ReactiveVar([])\r\ntotalFunds = new ReactiveVar(BigNumber(0))\r\ninvestmentList = new ReactiveVar([])\r\ncycleNumber = new ReactiveVar(0)\r\ncommissionRate = new ReactiveVar(BigNumber(0))\r\nassetFeeRate = new ReactiveVar(BigNumber(0))\r\npaused = new ReactiveVar(false)\r\nallowEmergencyWithdraw = new ReactiveVar(false)\r\nlastCommissionRedemption = new ReactiveVar(0)\r\ncycleTotalCommission = new ReactiveVar(BigNumber(0))\r\n\r\n# Displayed variables\r\nkairoAddr = new ReactiveVar(\"\")\r\nsharesAddr = new ReactiveVar(\"\")\r\nkyberAddr = new ReactiveVar(\"\")\r\ndaiAddr = new ReactiveVar(\"\")\r\ndisplayedInvestmentBalance = new ReactiveVar(BigNumber(0))\r\ndisplayedInvestmentUnit = new ReactiveVar(\"DAI\")\r\ndisplayedKairoBalance = new ReactiveVar(BigNumber(0))\r\ndisplayedKairoUnit = new ReactiveVar(\"KRO\")\r\ncountdownDay = new ReactiveVar(0)\r\ncountdownHour = new ReactiveVar(0)\r\ncountdownMin = new ReactiveVar(0)\r\ncountdownSec = new ReactiveVar(0)\r\nshowCountdown = new ReactiveVar(true)\r\ntransactionHash = new ReactiveVar(\"\")\r\nnetworkName = new ReactiveVar(\"\")\r\nnetworkPrefix = new ReactiveVar(\"\")\r\nchart = null\r\nprevROI = new ReactiveVar(BigNumber(0))\r\navgROI = new ReactiveVar(BigNumber(0))\r\nprevCommission = new ReactiveVar(BigNumber(0))\r\nhistoricalTotalCommission = new ReactiveVar(BigNumber(0))\r\ntransactionHistory = new ReactiveVar([])\r\nerrorMessage = new ReactiveVar(\"\")\r\nsuccessMessage = new ReactiveVar(\"\")\r\n\r\nshowTransaction = (_txHash) ->\r\n  transactionHash.set(_txHash)\r\n  $(\"#transaction_sent_modal\").modal(\"show\")\r\n  return\r\n\r\nshowError = (_msg) ->\r\n  errorMessage.set(_msg)\r\n  $(\"#error_modal\").modal(\"show\")\r\n\r\nshowSuccess = (_msg) ->\r\n  successMessage.set(_msg)\r\n  $(\"#success_modal\").modal(\"show\")\r\n\r\ncopyTextToClipboard = (text) ->\r\n  textArea = document.createElement(\"textarea\")\r\n\r\n  # Place in top-left corner of screen regardless of scroll position.\r\n  textArea.style.position = \"fixed\"\r\n  textArea.style.top = 0\r\n  textArea.style.left = 0\r\n\r\n  # Ensure it has a small width and height. Setting to 1px / 1em\r\n  # doesn't work as this gives a negative w/h on some browsers.\r\n  textArea.style.width = \"2em\"\r\n  textArea.style.height = \"2em\"\r\n\r\n  # We don't need padding, reducing the size if it does flash render.\r\n  textArea.style.padding = 0\r\n\r\n  # Clean up any borders.\r\n  textArea.style.border = \"none\"\r\n  textArea.style.outline = \"none\"\r\n  textArea.style.boxShadow = \"none\"\r\n\r\n  # Avoid flash of white box if rendered for any reason.\r\n  textArea.style.background = \"transparent\"\r\n\r\n  textArea.value = text\r\n\r\n  document.body.appendChild(textArea)\r\n\r\n  textArea.select()\r\n\r\n  try\r\n    successful = document.execCommand(\"copy\")\r\n    if successful\r\n      showSuccess(\"Copied #{text} to clipboard\")\r\n    else\r\n      showError(\"Oops, unable to copy\")\r\n  catch err\r\n    showError(\"Oops, unable to copy\")\r\n\r\n  document.body.removeChild(textArea)\r\n  return\r\n\r\nclock = () ->\r\n  setInterval(\r\n    () ->\r\n      now = Math.floor(new Date().getTime() / 1000)\r\n      target = startTimeOfCyclePhase.get() + phaseLengths.get()[cyclePhase.get()]\r\n      distance = target - now\r\n\r\n      if distance > 0\r\n        showCountdown.set(true)\r\n        days = Math.floor(distance / (60 * 60 * 24))\r\n        hours = Math.floor((distance % (60 * 60 * 24)) / (60 * 60))\r\n        minutes = Math.floor((distance % (60 * 60)) / 60)\r\n        seconds = Math.floor(distance % 60)\r\n\r\n        countdownDay.set(days)\r\n        countdownHour.set(hours)\r\n        countdownMin.set(minutes)\r\n        countdownSec.set(seconds)\r\n      else\r\n        showCountdown.set(false)\r\n  , 1000)\r\n\r\nloadFundData = () ->\r\n  investments = []\r\n  receivedROICount = 0\r\n\r\n  # Get Network ID\r\n  netID = await web3.eth.net.getId()\r\n  switch netID\r\n    when 1\r\n      net = \"Main Ethereum Network\"\r\n      pre = \"\"\r\n    when 3\r\n      net = \"Ropsten Testnet\"\r\n      pre = \"ropsten.\"\r\n    when 4\r\n      net = \"Rinkeby Testnet\"\r\n      pre = \"rinkeby.\"\r\n    when 42\r\n      net = \"Kovan Testnet\"\r\n      pre = \"kovan.\"\r\n    else\r\n      net = \"Unknown Network\"\r\n      pre = \"\"\r\n  networkName.set(net)\r\n  networkPrefix.set(pre)\r\n  if netID != 4\r\n    showError(\"Please switch to Rinkeby Testnet in order to try Betoken Alpha\")\r\n\r\n  # Get user address\r\n  userAddr = (await web3.eth.getAccounts())[0]\r\n  web3.eth.defaultAccount = userAddr\r\n  if userAddr?\r\n    userAddress.set(userAddr)\r\n\r\n  # Get shares balance\r\n  sharesTotalSupply.set(BigNumber(await betoken.getShareTotalSupply()))\r\n  totalFunds.set(BigNumber(await betoken.getPrimitiveVar(\"totalFundsInDAI\")))\r\n  sharesBalance.set(BigNumber(await betoken.getShareBalance(userAddr)))\r\n  if !sharesTotalSupply.get().isZero()\r\n    displayedInvestmentBalance.set(sharesBalance.get().div(sharesTotalSupply.get()).mul(totalFunds.get()).div(1e18))\r\n\r\n  # Get user's Kairo balance\r\n  kairoBalance.set(BigNumber(await betoken.getKairoBalance(userAddr)))\r\n  kairoTotalSupply.set(BigNumber(await betoken.getKairoTotalSupply()))\r\n  displayedKairoBalance.set(kairoBalance.get().div(1e18))\r\n\r\n  # Get fund data\r\n  cycleNumber.set(+await betoken.getPrimitiveVar(\"cycleNumber\"))\r\n  cyclePhase.set(+await betoken.getPrimitiveVar(\"cyclePhase\"))\r\n  startTimeOfCyclePhase.set(+await betoken.getPrimitiveVar(\"startTimeOfCyclePhase\"))\r\n  phaseLengths.set(await betoken.getPrimitiveVar(\"getPhaseLengths\").map((x) -> +x))\r\n  commissionRate.set(BigNumber(await betoken.getPrimitiveVar(\"commissionRate\")).div(1e18))\r\n  paused.set(await betoken.getPrimitiveVar(\"paused\"))\r\n  allowEmergencyWithdraw.set(await betoken.getPrimitiveVar(\"allowEmergencyWithdraw\"))\r\n  cycleTotalCommission.set(BigNumber(await betoken.getPrimitiveVar(\"totalCommission\")))\r\n  assetFeeRate.set(BigNumber(await betoken.getPrimitiveVar(\"assetFeeRate\")))\r\n\r\n  # Get last commission redemption cycle number\r\n  lastCommissionRedemption.set(+await betoken.getMappingOrArrayItem(\"lastCommissionRedemption\", userAddr))\r\n\r\n  # Get list of investments\r\n  investments = await betoken.getInvestments(userAddress.get())\r\n  if investments.length != 0\r\n    handleProposal = (id) ->\r\n      betoken.getTokenSymbol(investments[id].tokenAddress).then(\r\n        (_symbol) ->\r\n          investments[id].id = id\r\n          investments[id].tokenSymbol = _symbol\r\n          investments[id].investment = BigNumber(investments[id].stake).div(kairoTotalSupply.get()).mul(totalFunds.get()).div(1e18).toFormat(4)\r\n          investments[id].ROI = if investments[id].isSold then BigNumber(investments[id].sellPrice).sub(investments[id].buyPrice).div(investments[id].buyPrice).toFormat(4) else \"N/A\"\r\n          investments[id].kroChange = if investments[id].isSold then BigNumber(investments[id].ROI).mul(investments[id].stake).div(1e18).toFormat(4) else \"N/A\"\r\n          investments[id].stake = BigNumber(investments[id].stake).div(1e18).toFormat(4)\r\n      )\r\n    handleAllProposals = (handleProposal(i) for i in [0..investments.length-1])\r\n    await Promise.all(handleAllProposals)\r\n    investmentList.set(investments)\r\n\r\n  # Get deposit and withdraw history\r\n  transactionHistory.set([])\r\n  getDepositWithdrawHistory = (_type) ->\r\n    events = await betoken.contracts.betokenFund.getPastEvents(_type,\r\n      fromBlock: 0\r\n      filter: {_sender: userAddr}\r\n    )\r\n    for event in events\r\n      data = event.returnValues\r\n      entry =\r\n        type: _type\r\n        timestamp: new Date(+data._timestamp * 1e3).toString()\r\n        token: await betoken.getTokenSymbol(data._tokenAddress)\r\n        amount: BigNumber(data._tokenAmount).div(10**(+await betoken.getTokenDecimals(data._tokenAddress))).toFormat(4)\r\n      tmp = transactionHistory.get()\r\n      tmp.push(entry)\r\n      transactionHistory.set(tmp)\r\n  getDepositWithdrawHistory(\"Deposit\")\r\n  getDepositWithdrawHistory(\"Withdraw\")\r\n\r\n  # Get token transfer history\r\n  getTransferHistory = (token, isIn) ->\r\n    tokenContract = switch token\r\n      when \"KRO\" then betoken.contracts.controlToken\r\n      when \"BTKS\" then betoken.contracts.shareToken\r\n      else null\r\n    events = await tokenContract.getPastEvents(\"Transfer\",\r\n      fromBlock: 0\r\n      filter: if not isIn then {from: userAddr} else {to: userAddr}\r\n    )\r\n    for _event in events\r\n      data = _event.returnValues\r\n      entry =\r\n        type: \"Transfer \" + if isIn then \"In\" else \"Out\"\r\n        token: token\r\n        amount: BigNumber(data.value).div(1e18).toFormat(4)\r\n        timestamp: new Date((await web3.eth.getBlock(_event.blockNumber)).timestamp * 1e3).toString()\r\n      tmp = transactionHistory.get()\r\n      tmp.push(entry)\r\n      transactionHistory.set(tmp)\r\n\r\n  getTransferHistory(\"KRO\", true)\r\n  getTransferHistory(\"KRO\", false)\r\n  getTransferHistory(\"BTKS\", true)\r\n  getTransferHistory(\"BTKS\", false)\r\n\r\n  # Get contract addresses\r\n  kairoAddr.set(betoken.addrs.controlToken)\r\n  sharesAddr.set(betoken.addrs.shareToken)\r\n  kyberAddr.set(await betoken.getPrimitiveVar(\"kyberAddr\"))\r\n  daiAddr.set(await betoken.getPrimitiveVar(\"daiAddr\"))\r\n  tmp = tokenAddresses.get()\r\n  tmp[\"DAI\"] = daiAddr.get()\r\n  tokenAddresses.set(tmp)\r\n\r\n  # Get statistics\r\n  prevROI.set(BigNumber(0))\r\n  avgROI.set(BigNumber(0))\r\n  prevCommission.set(BigNumber(0))\r\n  historicalTotalCommission.set(BigNumber(0))\r\n\r\n  # Get commission\r\n  events = await betoken.contracts.betokenFund.getPastEvents(\"TotalCommissionPaid\",\r\n    fromBlock: 0\r\n  )\r\n  for _event in events\r\n    data = _event.returnValues\r\n\r\n    commission = BigNumber(data._totalCommissionInWeis)\r\n    # Update previous cycle commission\r\n    if +data._cycleNumber == cycleNumber.get() - 1\r\n      prevCommission.set(commission)\r\n\r\n    # Update total commission\r\n    historicalTotalCommission.set(historicalTotalCommission.get().add(commission))\r\n\r\n  # Draw chart\r\n  chart.data.datasets[0].data = []\r\n  chart.update()\r\n  events = await betoken.contracts.betokenFund.getPastEvents(\"ROI\",\r\n    fromBlock: 0\r\n  )\r\n  for _event in events\r\n    data = _event.returnValues\r\n    ROI = BigNumber(data._afterTotalFunds).minus(data._beforeTotalFunds).div(data._afterTotalFunds).mul(100)\r\n\r\n    #Update chart data\r\n    chart.data.datasets[0].data.push(\r\n      x: data._cycleNumber\r\n      y: ROI.toString()\r\n    )\r\n    chart.update()\r\n\r\n    #Update previous cycle ROI\r\n    if +data._cycleNumber == cycleNumber.get() || +data._cycleNumber == cycleNumber.get() - 1\r\n      prevROI.set(ROI)\r\n\r\n    # Update average ROI\r\n    receivedROICount += 1\r\n    avgROI.set(avgROI.get().add(ROI.minus(avgROI.get()).div(receivedROICount)))\r\n  return\r\n\r\n$(\"document\").ready(() ->\r\n  $(\".menu .item\").tab()\r\n  $(\"table\").tablesort()\r\n\r\n  if typeof web3 != \"undefined\"\r\n    web3.eth.net.getId().then(\r\n      (_id) ->\r\n        if _id != 4\r\n          showError(\"Please switch to Rinkeby Testnet in order to try Betoken Alpha\")\r\n        return\r\n    )\r\n\r\n    clock()\r\n\r\n    chart = new Chart($(\"#myChart\"),\r\n      type: \"line\",\r\n      data:\r\n        datasets: [\r\n          label: \"ROI Per Cycle\"\r\n          backgroundColor: \"rgba(0, 0, 100, 0.5)\"\r\n          borderColor: \"rgba(0, 0, 100, 1)\"\r\n          data: []\r\n        ]\r\n      ,\r\n      options:\r\n        scales:\r\n          xAxes: [\r\n            type: \"linear\"\r\n            position: \"bottom\"\r\n            scaleLabel:\r\n              display: true\r\n              labelString: \"Investment Cycle\"\r\n            ticks:\r\n              stepSize: 1\r\n          ]\r\n          yAxes: [\r\n            type: \"linear\"\r\n            position: \"left\"\r\n            scaleLabel:\r\n              display: true\r\n              labelString: \"Percent\"\r\n            ticks:\r\n              beginAtZero: true\r\n          ]\r\n    )\r\n\r\n    #Initialize Betoken object\r\n    betoken.init().then(loadFundData)\r\n\r\n  if !hasWeb3\r\n    showError(\"Betoken can only be used in a Web3 enabled browser. Please install <a href=\\\"https://metamask.io/\\\">MetaMask</a> or switch to another browser that supports Web3. You can currently view the fund's data, but cannot make any interactions.\")\r\n)\r\n\r\nTemplate.body.helpers(\r\n  transaction_hash: () -> transactionHash.get()\r\n  network_prefix: () -> networkPrefix.get()\r\n  error_msg: () -> errorMessage.get()\r\n  success_msg: () -> successMessage.get()\r\n)\r\n\r\nTemplate.body.events(\r\n  \"click .copyable\": (event) ->\r\n    copyTextToClipboard(event.target.innerText)\r\n)\r\n\r\nTemplate.top_bar.helpers(\r\n  show_countdown: () -> showCountdown.get()\r\n  paused: () -> paused.get()\r\n  allow_emergency_withdraw: () -> if allowEmergencyWithdraw.get() then \"\" else \"disabled\"\r\n  betoken_addr: () -> betoken_addr.get()\r\n  kairo_addr: () -> kairoAddr.get()\r\n  shares_addr: () -> sharesAddr.get()\r\n  kyber_addr: () -> kyberAddr.get()\r\n  dai_addr: () -> daiAddr.get()\r\n  ast_addr: () -> tokenAddresses.get()[\"AST\"]\r\n  network_prefix: () -> networkPrefix.get()\r\n)\r\n\r\nTemplate.top_bar.events(\r\n  \"click .next_phase\": (event) ->\r\n    try\r\n      betoken.nextPhase(showTransaction)\r\n    catch error\r\n      console.log error\r\n\r\n  \"click .emergency_withdraw\": (event) ->\r\n    betoken.emergencyWithdraw(showTransaction)\r\n\r\n  \"click .info_button\": (event) ->\r\n    $(\"#contract_info_modal\").modal(\"show\")\r\n)\r\n\r\nTemplate.countdown_timer.helpers(\r\n  day: () -> countdownDay.get()\r\n  hour: () -> countdownHour.get()\r\n  minute: () -> countdownMin.get()\r\n  second: () -> countdownSec.get()\r\n)\r\n\r\nTemplate.phase_indicator.helpers(\r\n  phase_active: (index) ->\r\n    if cyclePhase.get() == index\r\n      return \"active\"\r\n    return \"\"\r\n)\r\n\r\nTemplate.sidebar.helpers(\r\n  network_name: () -> networkName.get()\r\n  user_address: () -> userAddress.get()\r\n  user_balance: () -> displayedInvestmentBalance.get().toFormat(18)\r\n  balance_unit: () -> displayedInvestmentUnit.get()\r\n  user_kairo_balance: () -> displayedKairoBalance.get().toFormat(18)\r\n  kairo_unit: () -> displayedKairoUnit.get()\r\n  can_redeem_commission: () -> cyclePhase.get() == 2 && lastCommissionRedemption.get() < cycleNumber.get()\r\n  expected_commission: () ->\r\n    if kairoTotalSupply.get().greaterThan(0)\r\n      if cyclePhase.get() == 2\r\n        # Actual commission that will be redeemed\r\n        return kairoBalance.get().div(kairoTotalSupply.get()).mul(cycleTotalCommission.get()).div(1e18).toFormat(18)\r\n      # Expected commission based on previous average ROI\r\n      roi = if avgROI.get().gt(0) then avgROI.get() else BigNumber(0)\r\n      return kairoBalance.get().div(kairoTotalSupply.get()).mul(totalFunds.get().div(1e18)).mul(roi.div(100).mul(commissionRate.get()).add(assetFeeRate.get().div(1e18))).toFormat(18)\r\n    return BigNumber(0).toFormat(18)\r\n)\r\n\r\nTemplate.sidebar.events(\r\n  \"click .kairo_unit_switch\": (event) ->\r\n    if event.target.checked\r\n      #Display proportion\r\n      if !kairoTotalSupply.get().isZero()\r\n        displayedKairoBalance.set(kairoBalance.get().div(kairoTotalSupply.get()).times(\"100\"))\r\n      displayedKairoUnit.set(\"%\")\r\n    else\r\n      #Display Kairo\r\n      displayedKairoBalance.set(BigNumber(kairoBalance.get().div(1e18)))\r\n      displayedKairoUnit.set(\"KRO\")\r\n\r\n  \"click .balance_unit_switch\": (event) ->\r\n    if event.target.checked\r\n      #Display BTKS\r\n      displayedInvestmentBalance.set(sharesBalance.get().div(1e18))\r\n      displayedInvestmentUnit.set(\"BTKS\")\r\n    else\r\n      #Display DAI\r\n      if !sharesTotalSupply.get().isZero()\r\n        displayedInvestmentBalance.set(sharesBalance.get().div(sharesTotalSupply.get()).mul(totalFunds.get()).div(1e18))\r\n      displayedInvestmentUnit.set(\"DAI\")\r\n\r\n  \"click .redeem_commission\": (event) ->\r\n    betoken.redeemCommission(showTransaction)\r\n\r\n  \"click .redeem_commission_in_shares\": (event) ->\r\n    betoken.redeemCommissionInShares(showTransaction)\r\n)\r\n\r\nTemplate.transact_box.onCreated(\r\n  () ->\r\n    Template.instance().depositInputHasError = new ReactiveVar(false)\r\n    Template.instance().withdrawInputHasError = new ReactiveVar(false)\r\n    Template.instance().sendTokenAmountInputHasError = new ReactiveVar(false)\r\n    Template.instance().sendTokenRecipientInputHasError = new ReactiveVar(false)\r\n)\r\n\r\nTemplate.transact_box.helpers(\r\n  is_disabled: (_type) ->\r\n    if (cyclePhase.get() != 0 && _type != \"token\") || (cyclePhase.get() == 2 && _type == \"token\")\r\n      \"disabled\"\r\n\r\n  has_error: (input_id) ->\r\n    hasError = false\r\n    switch input_id\r\n      when 0\r\n        hasError = Template.instance().depositInputHasError.get()\r\n      when 1\r\n        hasError = Template.instance().withdrawInputHasError.get()\r\n      when 2\r\n        hasError = Template.instance().sendTokenAmountInputHasError.get()\r\n      when 3\r\n        hasError = Template.instance().sendTokenRecipientInputHasError.get()\r\n\r\n    if hasError\r\n      \"error\"\r\n\r\n  transaction_history: () -> transactionHistory.get()\r\n)\r\n\r\nTemplate.transact_box.events(\r\n  \"click .deposit_button\": (event) ->\r\n    try\r\n      Template.instance().depositInputHasError.set(false)\r\n      amount = BigNumber($(\"#deposit_input\")[0].value)\r\n      tokenType = $(\"#deposit_token_type\")[0].value\r\n\r\n      if !amount.greaterThan(0)\r\n        Template.instance().sendTokenAmountInputHasError.set(true)\r\n        return\r\n\r\n      if tokenType == \"ETH\"\r\n        betoken.deposit(amount.mul(1e18), showTransaction)\r\n      else\r\n        tokenAddr = tokenAddresses.get()[tokenType]\r\n        betoken.depositToken(tokenAddr, amount, showTransaction)\r\n    catch\r\n      Template.instance().depositInputHasError.set(true)\r\n\r\n  \"click .withdraw_button\": (event) ->\r\n    try\r\n      Template.instance().withdrawInputHasError.set(false)\r\n      amount = BigNumber($(\"#withdraw_input\")[0].value)\r\n      tokenType = $(\"#withdraw_token_type\")[0].value\r\n\r\n      if !amount.greaterThan(0)\r\n        Template.instance().sendTokenAmountInputHasError.set(true)\r\n        return\r\n\r\n      if tokenType == \"ETH\"\r\n        betoken.withdraw(amount.mul(1e18), showTransaction)\r\n      else\r\n        tokenAddr = tokenAddresses.get()[tokenType]\r\n        betoken.withdrawToken(tokenAddr, amount, showTransaction)\r\n    catch error\r\n      Template.instance().withdrawInputHasError.set(true)\r\n\r\n  \"click .token_send_button\": (event) ->\r\n    try\r\n      Template.instance().sendTokenAmountInputHasError.set(false)\r\n      Template.instance().sendTokenRecipientInputHasError.set(false)\r\n\r\n      amount = BigNumber(web3.utils.toWei($(\"#send_token_amount_input\")[0].value))\r\n      toAddress = $(\"#send_token_recipient_input\")[0].value\r\n      tokenType = $(\"#send_token_type\")[0].value\r\n\r\n      if !amount.greaterThan(0)\r\n        Template.instance().sendTokenAmountInputHasError.set(true)\r\n        return\r\n\r\n      if !web3.utils.isAddress(toAddress)\r\n        Template.instance().sendTokenRecipientInputHasError.set(true)\r\n        return\r\n\r\n      if tokenType == \"KRO\"\r\n        if amount.greaterThan(kairoBalance.get())\r\n          Template.instance().sendTokenAmountInputHasError.set(true)\r\n          return\r\n        betoken.sendKairo(toAddress, amount, showTransaction)\r\n      else if tokenType == \"BTKS\"\r\n        if amount.greaterThan(sharesBalance.get())\r\n          Template.instance().sendTokenAmountInputHasError.set(true)\r\n          return\r\n        betoken.sendShares(toAddress, amount, showTransaction)\r\n    catch\r\n      Template.instance().sendTokenAmountInputHasError.set(true)\r\n)\r\n\r\nTemplate.stats_tab.helpers(\r\n  cycle_length: () -> BigNumber(phaseLengths.get().reduce((t, n) -> t+n)).div(24 * 60 * 60).toDigits(3)\r\n  total_funds: () -> totalFunds.get().div(\"1e18\").toFormat(2)\r\n  prev_roi: () -> prevROI.get().toFormat(2)\r\n  avg_roi: () -> avgROI.get().toFormat(2)\r\n  prev_commission: () -> prevCommission.get().div(1e18).toFormat(2)\r\n  historical_commission: () -> historicalTotalCommission.get().div(1e18).toFormat(2)\r\n)\r\n\r\nTemplate.decisions_tab.helpers(\r\n  investment_list: () -> investmentList.get()\r\n  wei_to_eth: (_weis) -> BigNumber(_weis).div(1e18).toFormat(4)\r\n  new_investment_is_disabled: () ->\r\n    if cyclePhase.get() == 1 then \"\" else \"disabled\"\r\n)\r\n\r\nTemplate.decisions_tab.events(\r\n  \"click .sell_investment\": (event) ->\r\n    id = this.id\r\n    if cyclePhase.get() == 1\r\n      betoken.sellAsset(id, showTransaction)\r\n\r\n  \"click .new_investment\": (event) ->\r\n    $(\"#new_investment_modal\").modal(\r\n      onApprove: (e) ->\r\n        try\r\n          tokenType = $(\"#invest_token_type\")[0].value\r\n          address = tokenAddresses.get()[tokenType]\r\n\r\n          kairoAmountInWeis = BigNumber($(\"#stake_input_new\")[0].value).times(\"1e18\")\r\n          checkKairoAmountError(kairoAmountInWeis)\r\n\r\n          betoken.createInvestment(address, kairoAmountInWeis, showTransaction)\r\n        catch error\r\n          showError(error.toString() || INPUT_ERR)\r\n    ).modal(\"show\")\r\n)\r\n\r\ncheckKairoAmountError = (kairoAmountInWeis) ->\r\n  if !kairoAmountInWeis.greaterThan(0)\r\n    throw \"Stake amount should be positive.\"\r\n  if kairoAmountInWeis.greaterThan(kairoBalance.get())\r\n    throw \"You can't stake more Kairos than you have!\"\r\n"
  ]
}